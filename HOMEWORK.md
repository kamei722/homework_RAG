# AIエンジニアリング実践講座2025 第3回任意課題レポート

## 1. 質問設計の観点と意図

本課題では、NBA (National Basketball Association) の2023-2024シーズンに関する5つの質問を設計しました。直近の特定の期間の情報に関する質問により、RAGを利用した、AIモデルの知識の範囲、情報検索能力、最新情報への対応力、そしてデータに基づいた推論能力を評価することを目的としています。

設計した質問とそれぞれの意図は以下の通りです。

1.  **Q1: NBAって何？**
    *   **意図:** モデルが持つ基本的な知識と、一般的な説明能力を確認する。RAGシステムがこの種の質問にどのように応答するかも観察する。
    *   **期待する回答:** アメリカのプロバスケットボールリーグであること、その特徴など。
2.  **Q2: 有名なNBA選手を5人教えて**
    *   **意図:** モデルの一般的な知識ベースから、複数のエンティティを列挙する能力を評価する。RAGシステムが参照情報に基づいてどのような選手リストを生成するかを比較する。
    *   **期待する回答:** レブロン・ジェームズ、ステフィン・カリーなど、一般的に広く認知されている選手。
3.  **Q3: 2023-2024シーズンのAll NBA First teamに選ばれた5人は？**
    *   **意図:** LLMの学習データに含まれていない可能性が高い最新の具体的な事実情報を検索するRAGシステムの能力を評価する。
    *   **期待する回答:** シェイ・ギルジャス・アレクサンダー、ニコラ・ヨキッチ、ルカ・ドンチッチ、ヤニス・アデトクンポ、ジェイソン・テイタム。
4.  **Q4: 2023-2024シーズンのNBAのウェスタンカンファレンスの最高勝率チームとその戦績は？**
    *   **意図:** 特定の条件（ウェスタンカンファレンス、最高勝率）を満たす情報を検索し、関連情報を統合して回答するRAGシステムの能力を評価する。同率一位のようなイレギュラーケースへの対応も見る。
    *   **期待する回答:** オクラホマシティサンダーとデンバーナゲッツ (57勝25敗)。
5.  **Q5: 2024-2025のシーズンのNBAはどのチームが強いと思う？**
    *   **意図:** 正解のない未来予測に対して、RAGが提供する情報を基にLLMがどの程度根拠のある推論や意見形成を行えるかを評価する。
    *   **期待する回答:** 昨シーズンの成績やチーム状況を踏まえた、論理的な予測（例：オクラホマシティサンダーの若手主体のチームの将来性など）。

これらの質問を通じて、RAGシステムがLLMの回答品質をどのように向上させるか、またどのような課題が残るのかを明らかにすることを目指しました。

## 2. RAGの実装方法と工夫点

本実験におけるRAGシステムの実装は講義での演習で用いられたnotebookを利用した簡素なものです。

*   **使用モデル:**
    *   大規模言語モデル (LLM): `google/gemma-2-2b-jpn-it`
    *   エンベディングモデル: `infly/inf-retriever-v1-1.5b`
*   **参照文書 (ドキュメント) の準備:**
    *   **データソース:** [Basketball-Reference.com](https://www.basketball-reference.com/leagues/NBA_2024.html) より、2023-2024シーズンの以下のデータをCSV形式で入手。
        *   Eastern Conference Standings
        *   Western Conference Standings
        *   Team Per Game Stats
        *   Player Per Game Stats
    *   **ドキュメント化:** 入手したCSVデータの各行を、自然言語の文章形式に変換。
        *   例 (Player Per Game Stats): 「{選手名}選手 ({年齢}歳、{ポジション}) は2023-2024シーズンに{チーム名}に所属し、{出場試合数}試合に出場（うち{先発試合数}試合先発）、1試合平均{平均出場時間}分プレイしました。平均スタッツ: {得点}得点、{リバウンド}リバウンド、{アシスト}アシスト...。受賞歴: {受賞歴}。」
        *   この処理により、合計約719件のドキュメントを作成しました。
*   **ドキュメントのチャンク化:**
    *   上記で作成した各文章を1つのドキュメント（チャンク）として扱いました。
*   **検索方法 (Retrieval):**
    *   ユーザーからの質問と、準備した全ドキュメントをエンベディングモデルでベクトル化。
    *   質問ベクトルと各ドキュメントベクトルのコサイン類似度 (内積) を計算。
    *   類似度スコアの高い上位20件 (topk=20) のドキュメントを抽出。
*   **その他:**
    *   実験はGoogle Colab (GPU: T4) 上で実施。
    *   乱数シードを固定し、実験の再現性を担保。

## 3. 結果の分析と考察

各質問に対するRAGなし (ベースラインLLM) とRAGありの回答を比較し、分析・考察を行いました。

### Q1: NBAって何？

*   **RAGなし:**
    *   回答: 「NBAは、National Basketball Association (アメリカンバスケットボール協会) の略称です。簡単に言うと、アメリカで人気のあるバスケットボールリーグです。主な特徴: 世界的に人気のあるスポーツ、トップレベルの選手、注目度の高い試合、チームの競争。」
    *   分析: LLMの一般知識に基づき、網羅的で分かりやすい説明を生成。十分な制度。
*   **RAGあり:**
    *   回答: 「NBAは、National Basketball Associationの略称です。簡単に言うと、アメリカ合衆国で人気のあるスポーツであるバスケットボールの頂上競技団体です。」
    *   分析: RAGなしより簡潔な回答。参照文書が具体的なシーズンデータ中心だったため、一般的な説明に関する情報は少なく、LLM自身の知識に頼りつつも出力が絞られた可能性がある。

### Q2: 有名なNBA選手を5人教えて

*   **RAGなし:**
    *    回答: 
            1. **LeBron James:**  NBAのレジェンドとして知られる、非常に才能と強さを持つ選手。
            2. **Stephen Curry:**  3ポイントの技術が非常に高い、人気のある選手。
            3. **Giannis Antetokounmpo:**  身体能力とパワーで、チームに大きな影響を与える選手。
            4. **Kevin Durant:**  高いシュート力と、チームに安定をもたらす選手。
            5. **Nikola Jokic:**  パスと得点力、そしてチームのリーダーシップを持つ選手。
    *  分析: いわゆる認知度の高いスター選手を中心とした、妥当な選手リストと説明を生成。
*   **RAGあり:**
    *   回答:
            * Anthony Davis
            * Jayson Tatum
            * LeBron James
            * Nikola JokiÄ
            * Stephen Curry 
    *   分析: リスト自体は妥当だが、参照文書 (2023-24シーズンデータ) の影響で選手の選定に変化が見られ、また、参照文書の文字化けの影響も生じてしまった (JokiÄ‡)。説明が省略された。

### Q3: 2023-2024シーズンのAll NBA First teamに選ばれた5人は？

*   **期待する回答:** シェイ・ギルジャス・アレクサンダー、ニコラ・ヨキッチ、ルカ・ドンチッチ、ヤニス・アデトクンポ、ジェイソン・テイタム。
*   **RAGなし:**
    *   回答: 
    2023-2024シーズン All-NBA First Teamのメンバーは以下の通りです。
        * **PG:**  Ja Morant (Memphis Grizzlies)
        * **SG:**  Donovan Mitchell (Cleveland Cavaliers)
        * **SF:**  Giannis Antetokounmpo (Milwaukee Bucks)
        * **PF:**  Jayson Tatum (Boston Celtics)
        * **C:**  Joel Embiid (Philadelphia 76ers)

    *   分析: 過去のシーズンに近い情報（ハルシネーション）を生成。正解率は 2/5。
*   **RAGあり:**
    *   回答: 
        2023-2024シーズン All NBA First Teamのメンバーは以下の通りです。
        * **Stephen Curry** (GSW)
        * **Giannis Antetokounmpo** (MIL)
        * **Joel Embiid** (PHI)
        * **Nikola Jokić** (DEN)
        * **Jayson Tatum** (BOS)
    *   分析: RAGなしより改善し、正解率 3/5。ニコラ・ヨキッチが正しく含まれた。しかし、カリーとエンビードは誤り。参照文書の`Awards`列にある"NBA1"というピンポイントな情報抽出が難しかったと予想され、また参照するデータも不足していた。

### Q4: 2023-2024シーズンのNBAのウェスタンカンファレンスの最高勝率チームとその戦績は？

*   **期待する回答:** オクラホマシティサンダーとデンバーナゲッツ (57勝25敗)。
*   **RAGなし:**
    *   回答: 「申し訳ありませんが、リアルタイムの情報にアクセスできないため、2023-2024シーズンにおけるウェスタンカンファレンスの最高勝率チームとその戦績をお伝えできません。最新のNBA情報を取得するには、信頼できるスポーツニュースサイトをご確認ください。」
    *   分析: 最新情報がないため回答不可。そのことを伝える丁寧な反応だった。
*   **RAGあり:**
    *   回答: 「2023-2024シーズン NBAウェスタンカンファレンスの最高勝率チームは Denver Nuggets で、57勝25敗でした。」
    *   分析: デンバーナゲッツの情報は正しく抽出。しかし、同率1位のオクラホマシティサンダーへの言及はなかった。検索された上位20件の情報では、同率1位というイレギュラーな状況をカバーしきれなかったか、LLMが最も代表的と判断した1チームのみを回答した可能性。

### Q5: 2024-2025のシーズンのNBAはどのチームが強いと思う？

*   **RAGなし:**
    *   回答: 
            2024-2025シーズン、NBAの強豪チームはいくつか考えられますが、**どのチームが強いかは、まだ予測が難しいです**。

            **有力候補として挙げられるチーム:**

            * **Milwaukee Bucks:** Giannis Antetokounmpoの活躍が期待されます。
            * **Boston Celtics:**  Jayson TatumとJaylen Brownの強力な duoがチームを牽引します。
            * **Philadelphia 76ers:**  Joel Embiidの活躍がチームの勝利に大きく貢献するでしょう。
            * **Denver Nuggets:**  Nikola Jokicの卓越したプレイがチームの安定性を維持します。
            * **Phoenix Suns:** Devin Bookerの攻撃的なプレイがチームの攻撃力を高めます。

    *   分析: 一般的な知識に基づいた妥当なリストと説明である。そのチームのキープレイヤーも正確に言及できていいる。
*   **RAGあり:**
    *   回答: 
    2024-2025シーズン、NBAチームの強さは予測が難しいです。 

        しかし、いくつかのチームが注目されています。

        **有力候補:**

        * **Boston Celtics:**  2023-2024シーズンに圧倒的な強さを誇り、リーグ平均を上回る高い勝率と得点力を誇っています。
        * **Milwaukee Bucks:**  2023-2024シーズンに高い勝率を維持し、チームの安定性と経験が期待されます。
        * **Denver Nuggets:**  2023-2024シーズンに高い得点力とチームワークを誇り、2024-2025シーズンも強 contender と予想されます。
        * **Philadelphia 76ers:**  2023-2024シーズンに高い得点力とチームワークを誇り、2024-2025シーズンも強 contender と予想されます。
        

        **その他のチーム:**

        * **Golden State Warriors:**  2023-2024シーズンに高い得点力とチームワークを誇り、2024-2025シーズンも強 contender と予想されます
    
    *   分析: 提示されたチームに関してはRAGなしと同じようなチームを挙げることができているが、昨シーズンの実績を参照したような発言を加えている。一方で、説明が参照データに引きずられ、「2023-2024シーズンに〇〇を誇り...」という単調なパターンが多く見られた。参照情報にない視点からの回答は得られなかった。

### 総括的な考察

*   **RAGの有効性:**
    *   **最新情報への対応:** LLMが持たない最新の事実情報（シーズン成績、受賞歴など）を補完し、回答を生成する上で明確な効果が見られた。特にQ3、Q4ではRAGなしでは不可能だった回答が可能になる兆しがあり、適切なドキュメント生成や選別により解決できるだろうと考えられる。

*   **RAGの課題と限界点:**
    *   **参照文書の質とバイアスへの依存:**
        *   時間の都合で簡素なドキュメント生成になってしまった部分もあり、情報の正確性、参照文書の文字化け（例: `JokiÄ‡`）、実際に必要な情報の強調が必要だと認識した。
        *  時間と計算領域の影響で `topk=20`という設定で実験をしたが、より多くのパターンや、丁寧なデータ処理やRerankの処理を加える必要があるだろう。
    *   **質問タイプとの相性:**
        *   Q1のような一般的な知識を問う質問では、参照文書が特化していない限り、RAGの効果は限定的であり、逆にそれがノイズとなり回答の質を落としている様子も確認できた。 Q5のような深い洞察が求められる質問では、RAGが提供する「事実情報」だけでは不十分であるとも考えられる。
